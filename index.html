<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comedy Houston — Every comedy show in Houston. One place.</title>
  <meta name="description" content="Find every upcoming comedy show in Houston. Tickets for Houston Improv, The Riot, The Secret Group, Punch Line, and more.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ================================================================
       RESET & BASE
       ================================================================ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a26;
      --bg-card-hover: #22222f;
      --bg-input: #16161f;
      --border: #2a2a3a;
      --border-hover: #3a3a4f;
      --text-primary: #f0f0f5;
      --text-secondary: #9999aa;
      --text-muted: #666677;
      --accent: #ff4d6a;
      --accent-hover: #ff6b83;
      --accent-glow: rgba(255, 77, 106, 0.15);
      --accent-secondary: #7c5cff;
      --success: #22c55e;
      --warning: #f59e0b;
      --radius: 12px;
      --radius-sm: 8px;
      --radius-lg: 16px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
      --transition: 0.2s ease;
    }

    html {
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }
    img { display: block; max-width: 100%; }

    /* ================================================================
       HEADER
       ================================================================ */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(10, 10, 15, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }

    .header-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
    }

    .brand-name {
      font-size: 1.5rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .brand-tagline {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    .header-meta {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .event-count {
      background: var(--accent-glow);
      color: var(--accent);
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.8rem;
    }

    /* ================================================================
       CONTROLS BAR
       ================================================================ */
    .controls {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .filter-btn {
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-family: inherit;
      cursor: pointer;
      transition: all var(--transition);
      white-space: nowrap;
    }

    .filter-btn:hover {
      border-color: var(--border-hover);
      color: var(--text-primary);
      background: var(--bg-card-hover);
    }

    .filter-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      font-weight: 600;
    }

    .select-wrapper {
      position: relative;
    }

    .select-wrapper select {
      appearance: none;
      -webkit-appearance: none;
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 8px 36px 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-family: inherit;
      cursor: pointer;
      transition: all var(--transition);
    }

    .select-wrapper select:hover {
      border-color: var(--border-hover);
      color: var(--text-primary);
    }

    .select-wrapper::after {
      content: '';
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 5px solid var(--text-muted);
      pointer-events: none;
    }

    .controls-spacer {
      flex: 1;
    }

    .sort-label {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* ================================================================
       MAIN CONTENT
       ================================================================ */
    .main {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 24px 80px;
    }

    /* Date group headers */
    .date-group {
      margin-top: 32px;
    }

    .date-group:first-child {
      margin-top: 8px;
    }

    .date-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 8px;
    }

    .date-header-text {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      white-space: nowrap;
    }

    .date-header-line {
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .date-header-count {
      font-size: 0.8rem;
      color: var(--text-muted);
      white-space: nowrap;
    }

    /* Event grid */
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    /* ================================================================
       EVENT CARD
       ================================================================ */
    .event-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(16px);
      animation: cardFadeIn 0.4s ease forwards;
    }

    .event-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      background: var(--bg-card-hover);
    }

    @keyframes cardFadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card-image {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 */
      background: var(--bg-secondary);
      overflow: hidden;
    }

    .card-image img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    .event-card:hover .card-image img {
      transform: scale(1.05);
    }

    .card-image-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 8px;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
    }

    .card-image-placeholder .venue-icon {
      font-size: 2rem;
      opacity: 0.3;
    }

    .card-image-placeholder .venue-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .card-source-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      backdrop-filter: blur(4px);
    }

    .card-source-badge.ticketmaster { color: #0093d0; }
    .card-source-badge.eventbrite { color: #f05537; }

    .card-status-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      backdrop-filter: blur(4px);
    }

    .card-status-badge.on_sale {
      display: none;
    }

    .card-status-badge.cancelled {
      background: rgba(239, 68, 68, 0.9);
      color: #fff;
    }

    .card-status-badge.postponed,
    .card-status-badge.rescheduled {
      background: rgba(245, 158, 11, 0.9);
      color: #000;
    }

    .card-body {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card-date-time {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--accent);
      font-weight: 600;
    }

    .card-date-time .separator {
      width: 3px;
      height: 3px;
      background: var(--text-muted);
      border-radius: 50%;
    }

    .card-name {
      font-size: 1.05rem;
      font-weight: 700;
      line-height: 1.3;
      color: var(--text-primary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-venue {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-top: 4px;
    }

    .card-price {
      font-size: 0.9rem;
      color: var(--text-primary);
      font-weight: 600;
    }

    .card-price .from {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    .card-cta {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 18px;
      background: var(--accent);
      color: #fff;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      transition: all var(--transition);
      white-space: nowrap;
    }

    .card-cta:hover {
      background: var(--accent-hover);
      transform: scale(1.04);
    }

    .card-cta .arrow {
      transition: transform var(--transition);
    }

    .card-cta:hover .arrow {
      transform: translateX(2px);
    }

    /* ================================================================
       EMPTY STATE
       ================================================================ */
    .empty-state {
      text-align: center;
      padding: 80px 24px;
      color: var(--text-muted);
    }

    .empty-state h2 {
      font-size: 1.3rem;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }

    .empty-state p {
      font-size: 0.95rem;
    }

    /* ================================================================
       LOADING STATE
       ================================================================ */
    .loading {
      text-align: center;
      padding: 80px 24px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* ================================================================
       FOOTER
       ================================================================ */
    .footer {
      border-top: 1px solid var(--border);
      padding: 24px;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .footer a {
      color: var(--accent);
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    /* ================================================================
       RESPONSIVE
       ================================================================ */
    @media (max-width: 768px) {
      .header-inner {
        padding: 12px 16px;
      }

      .brand-tagline {
        display: none;
      }

      .controls {
        padding: 12px 16px;
      }

      .main {
        padding: 0 16px 60px;
      }

      .events-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .filter-btn {
        padding: 6px 12px;
        font-size: 0.8rem;
      }
    }

    @media (max-width: 480px) {
      .brand-name {
        font-size: 1.25rem;
      }

      .card-body {
        padding: 12px;
      }
    }

    /* Animation delays for staggered card entry */
    .event-card:nth-child(1)  { animation-delay: 0.02s; }
    .event-card:nth-child(2)  { animation-delay: 0.04s; }
    .event-card:nth-child(3)  { animation-delay: 0.06s; }
    .event-card:nth-child(4)  { animation-delay: 0.08s; }
    .event-card:nth-child(5)  { animation-delay: 0.10s; }
    .event-card:nth-child(6)  { animation-delay: 0.12s; }
    .event-card:nth-child(7)  { animation-delay: 0.14s; }
    .event-card:nth-child(8)  { animation-delay: 0.16s; }
    .event-card:nth-child(9)  { animation-delay: 0.18s; }
    .event-card:nth-child(10) { animation-delay: 0.20s; }
    .event-card:nth-child(11) { animation-delay: 0.22s; }
    .event-card:nth-child(12) { animation-delay: 0.24s; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-inner">
      <div class="brand">
        <span class="brand-name">Comedy Houston</span>
        <span class="brand-tagline">Every comedy show in Houston. One place.</span>
      </div>
      <div class="header-meta">
        <span class="event-count" id="eventCount">0 shows</span>
        <span id="updatedAt"></span>
      </div>
    </div>
  </header>

  <!-- FILTER CONTROLS -->
  <div class="controls" id="controls">
    <div class="filter-group" id="timeFilters">
      <button class="filter-btn active" data-filter="all">All Shows</button>
      <button class="filter-btn" data-filter="today">Today</button>
      <button class="filter-btn" data-filter="tomorrow">Tomorrow</button>
      <button class="filter-btn" data-filter="weekend">This Weekend</button>
      <button class="filter-btn" data-filter="week">This Week</button>
      <button class="filter-btn" data-filter="month">This Month</button>
    </div>

    <div class="select-wrapper">
      <select id="venueFilter">
        <option value="all">All Venues</option>
      </select>
    </div>

    <div class="select-wrapper">
      <select id="sourceFilter">
        <option value="all">All Sources</option>
        <option value="ticketmaster">Ticketmaster</option>
        <option value="eventbrite">Eventbrite</option>
      </select>
    </div>

    <div class="controls-spacer"></div>

    <span class="sort-label">Sort:</span>
    <div class="select-wrapper">
      <select id="sortSelect">
        <option value="date">Date</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
        <option value="name">Name A-Z</option>
      </select>
    </div>
  </div>

  <!-- MAIN -->
  <main class="main" id="main">
    <div class="loading" id="loadingState">
      <div class="spinner"></div>
      <div class="loading-text">Loading shows...</div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    Updated automatically twice daily &middot; Data from
    <a href="https://www.ticketmaster.com" target="_blank" rel="noopener">Ticketmaster</a> &amp;
    <a href="https://www.eventbrite.com" target="_blank" rel="noopener">Eventbrite</a>
  </footer>

  <script>
    // ================================================================
    // DATA — replaced at build time by fetch-events.js
    // ================================================================
    const EVENTS_DATA = [];
    const LAST_UPDATED = "";

    // ================================================================
    // APP STATE
    // ================================================================
    let allEvents = [];
    let currentTimeFilter = "all";
    let currentVenueFilter = "all";
    let currentSourceFilter = "all";
    let currentSort = "date";

    // ================================================================
    // INIT
    // ================================================================
    (async function init() {
      // Try embedded data first, then fall back to events.json
      if (EVENTS_DATA.length > 0) {
        allEvents = EVENTS_DATA;
        setUpdatedAt(LAST_UPDATED);
      } else {
        try {
          const resp = await fetch("events.json");
          if (resp.ok) {
            const data = await resp.json();
            allEvents = data.events || [];
            setUpdatedAt(data.last_updated);
          }
        } catch (e) {
          console.warn("Could not load events.json:", e);
        }
      }

      populateVenueFilter();
      bindEvents();
      render();
    })();

    // ================================================================
    // SETUP
    // ================================================================
    function setUpdatedAt(ts) {
      if (!ts) return;
      const d = new Date(ts);
      const el = document.getElementById("updatedAt");
      el.textContent = "Updated " + d.toLocaleDateString("en-US", {
        month: "short", day: "numeric", hour: "numeric", minute: "2-digit",
      });
    }

    function populateVenueFilter() {
      const venues = [...new Set(allEvents.map(e => e.venue))].sort();
      const sel = document.getElementById("venueFilter");
      for (const v of venues) {
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        sel.appendChild(opt);
      }
    }

    function bindEvents() {
      // Time filters
      document.querySelectorAll("#timeFilters .filter-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("#timeFilters .filter-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          currentTimeFilter = btn.dataset.filter;
          render();
        });
      });

      // Venue filter
      document.getElementById("venueFilter").addEventListener("change", (e) => {
        currentVenueFilter = e.target.value;
        render();
      });

      // Source filter
      document.getElementById("sourceFilter").addEventListener("change", (e) => {
        currentSourceFilter = e.target.value;
        render();
      });

      // Sort
      document.getElementById("sortSelect").addEventListener("change", (e) => {
        currentSort = e.target.value;
        render();
      });
    }

    // ================================================================
    // FILTERING & SORTING
    // ================================================================
    function getFiltered() {
      const now = new Date();
      const today = toDateStr(now);
      const tomorrow = toDateStr(addDays(now, 1));

      // Weekend: upcoming Saturday & Sunday
      const dayOfWeek = now.getDay(); // 0=Sun ... 6=Sat
      let satDate, sunDate;
      if (dayOfWeek === 0) {
        // Sunday — "this weekend" means today
        satDate = toDateStr(addDays(now, -1));
        sunDate = today;
      } else if (dayOfWeek === 6) {
        // Saturday
        satDate = today;
        sunDate = tomorrow;
      } else {
        const daysToSat = 6 - dayOfWeek;
        satDate = toDateStr(addDays(now, daysToSat));
        sunDate = toDateStr(addDays(now, daysToSat + 1));
      }
      // Also include Friday evening as "weekend"
      let friDate;
      if (dayOfWeek <= 5) {
        friDate = toDateStr(addDays(now, 5 - dayOfWeek));
      } else {
        friDate = toDateStr(addDays(now, -1)); // Saturday — Friday was yesterday
      }

      const endOfWeek = toDateStr(addDays(now, 7 - dayOfWeek));
      const endOfMonth = toDateStr(new Date(now.getFullYear(), now.getMonth() + 1, 0));

      let events = allEvents.filter(e => {
        if (!e.date) return false;
        // Don't show past events
        if (e.date < today) return false;
        // Don't show cancelled
        if (e.status === "cancelled") return false;

        // Time filter
        if (currentTimeFilter === "today" && e.date !== today) return false;
        if (currentTimeFilter === "tomorrow" && e.date !== tomorrow) return false;
        if (currentTimeFilter === "weekend") {
          if (e.date !== friDate && e.date !== satDate && e.date !== sunDate) return false;
        }
        if (currentTimeFilter === "week" && e.date > endOfWeek) return false;
        if (currentTimeFilter === "month" && e.date > endOfMonth) return false;

        // Venue filter
        if (currentVenueFilter !== "all" && e.venue !== currentVenueFilter) return false;

        // Source filter
        if (currentSourceFilter !== "all" && e.source !== currentSourceFilter) return false;

        // 90-day cap
        const maxDate = toDateStr(addDays(new Date(), 90));
        if (e.date > maxDate) return false;

        return true;
      });

      // Sort
      if (currentSort === "date") {
        events.sort((a, b) => {
          const dc = (a.date || "").localeCompare(b.date || "");
          return dc !== 0 ? dc : (a.time || "").localeCompare(b.time || "");
        });
      } else if (currentSort === "price-low") {
        events.sort((a, b) => (a.price_min || 9999) - (b.price_min || 9999));
      } else if (currentSort === "price-high") {
        events.sort((a, b) => (b.price_max || 0) - (a.price_max || 0));
      } else if (currentSort === "name") {
        events.sort((a, b) => a.name.localeCompare(b.name));
      }

      return events;
    }

    // ================================================================
    // RENDER
    // ================================================================
    function render() {
      const main = document.getElementById("main");
      const events = getFiltered();

      // Update count
      document.getElementById("eventCount").textContent =
        events.length + (events.length === 1 ? " show" : " shows");

      if (events.length === 0) {
        main.innerHTML = `
          <div class="empty-state">
            <h2>No shows found</h2>
            <p>Try changing your filters or check back later.</p>
          </div>`;
        return;
      }

      // Group by date
      const groups = new Map();
      for (const ev of events) {
        const key = ev.date || "Unknown Date";
        if (!groups.has(key)) groups.set(key, []);
        groups.get(key).push(ev);
      }

      let html = "";
      for (const [dateStr, evts] of groups) {
        const label = formatDateLabel(dateStr);
        html += `
          <section class="date-group">
            <div class="date-header">
              <span class="date-header-text">${label}</span>
              <span class="date-header-line"></span>
              <span class="date-header-count">${evts.length} show${evts.length !== 1 ? "s" : ""}</span>
            </div>
            <div class="events-grid">`;

        for (const ev of evts) {
          html += renderCard(ev);
        }

        html += `</div></section>`;
      }

      main.innerHTML = html;
    }

    function renderCard(ev) {
      const imageHTML = ev.image_url
        ? `<img src="${escapeAttr(ev.image_url)}" alt="${escapeAttr(ev.name)}" loading="lazy">`
        : `<div class="card-image-placeholder">
             <span class="venue-icon">&#127908;</span>
             <span class="venue-label">${escapeHTML(ev.venue)}</span>
           </div>`;

      const priceHTML = formatPrice(ev.price_min, ev.price_max, ev.currency);

      const statusClass = ev.status || "unknown";
      const statusLabel = (ev.status || "").replace(/_/g, " ");

      const ticketHTML = ev.ticket_url
        ? `<a class="card-cta" href="${escapeAttr(ev.ticket_url)}" target="_blank" rel="noopener">
             Get Tickets <span class="arrow">&rarr;</span>
           </a>`
        : `<span class="card-cta" style="opacity:0.5;cursor:default;">Coming Soon</span>`;

      return `
        <article class="event-card">
          <div class="card-image">
            ${imageHTML}
            <span class="card-source-badge ${escapeAttr(ev.source)}">${escapeHTML(ev.source)}</span>
            <span class="card-status-badge ${escapeAttr(statusClass)}">${escapeHTML(statusLabel)}</span>
          </div>
          <div class="card-body">
            <div class="card-date-time">
              <span>${escapeHTML(ev.day_of_week || "")}</span>
              <span class="separator"></span>
              <span>${escapeHTML(ev.time || "TBA")}</span>
              ${ev.age_restriction ? `<span class="separator"></span><span>${escapeHTML(ev.age_restriction)}</span>` : ""}
            </div>
            <h3 class="card-name">${escapeHTML(ev.name)}</h3>
            <div class="card-venue">${escapeHTML(ev.venue)}</div>
            <div class="card-footer">
              <div class="card-price">${priceHTML}</div>
              ${ticketHTML}
            </div>
          </div>
        </article>`;
    }

    // ================================================================
    // HELPERS
    // ================================================================
    function toDateStr(d) {
      return d.toISOString().slice(0, 10);
    }

    function addDays(d, n) {
      const r = new Date(d);
      r.setDate(r.getDate() + n);
      return r;
    }

    function formatDateLabel(dateStr) {
      const now = new Date();
      const today = toDateStr(now);
      const tomorrow = toDateStr(addDays(now, 1));

      if (dateStr === today) return "Tonight";
      if (dateStr === tomorrow) return "Tomorrow";

      const d = new Date(dateStr + "T12:00:00");
      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

      const diff = Math.floor((d - new Date(today + "T12:00:00")) / (1000 * 60 * 60 * 24));

      let prefix = "";
      if (diff >= 2 && diff <= 6) {
        prefix = "This ";
      } else if (diff >= 7 && diff <= 13) {
        prefix = "Next ";
      }

      return `${prefix}${days[d.getDay()]} &mdash; ${months[d.getMonth()]} ${d.getDate()}`;
    }

    function formatPrice(min, max, currency) {
      if (min === null && max === null) return '<span class="from">Price TBA</span>';
      if (min === 0 && (max === 0 || max === null)) return '<span style="color:var(--success);font-weight:600;">Free</span>';

      const fmt = (v) => {
        if (currency === "USD") return "$" + v.toFixed(0);
        return v.toFixed(0) + " " + currency;
      };

      if (min !== null && max !== null && min !== max) {
        return `<span class="from">From</span> ${fmt(min)}&ndash;${fmt(max)}`;
      }
      if (min !== null) {
        return `<span class="from">From</span> ${fmt(min)}`;
      }
      return `<span class="from">Up to</span> ${fmt(max)}`;
    }

    function escapeHTML(str) {
      if (!str) return "";
      return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
    }

    function escapeAttr(str) {
      if (!str) return "";
      return str.replace(/&/g, "&amp;").replace(/"/g, "&quot;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }
  </script>
</body>
</html>
